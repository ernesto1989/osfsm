<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="https://rawgit.com/vitmalina/w2ui/master/dist/w2ui.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-uWxY/CJNBR+1zjPWmfnSnVxwRheevXITnMqoEIeG1LJrdI0GlVs/9cVSyPYXdcSF" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-kQtW33rZJAHjgefvhyyzcGF3C5TFyBQBA13V1RKPf4uH+bwyzQxZ6CmMZHmNBEfJ" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="/OSF/css/osf_style.css" rel="stylesheet" />
    <title><%= __('app_name') %></title>
    <script type="module">
        import { w2tabs, w2sidebar, query,  w2form, w2ui, w2popup, w2alert, w2grid, w2toolbar,w2confirm } from 'https://rawgit.com/vitmalina/w2ui/master/dist/w2ui.es6.min.js'
        
        $('document').ready(function(){
        });


        let toolbar = new w2toolbar({
            box: '#toolbar',
            name: 'toolbar',
            items: [
                { type: 'button', id: 'home', text: '<%= __('app_name') %>', icon: 'fa fa-house' },
                { type: 'break' },
                { type: 'button', id: 'new', text: 'Create', icon: 'fa fa-pencil' },
                { type: 'button', id: 'delete', text: 'Delete', icon: 'fa fa-trash'},
                { type: 'spacer' },
                { type: 'menu', id: 'user', text: '<%=user_info.name%>', icon: 'fa fa-user', items:[
                    { type: 'button', id: 'region', text: '<%=user_info.region_name%>', icon: 'fa fa-circle-info' },
                    //{ type: 'button', id: 'pref', text: 'My Preferences', icon: 'fa fa-user' },
                    { type: 'button', id: 'sout', text: 'Sign Out', icon: 'fa fa-user-slash' }
                ] 
            }],
            onClick(event) {
                
                let selectedOp = event.target;
                
                if(selectedOp === 'home'){
                    window.location.reload();
                }
                if(selectedOp === 'new'){
                    openNewScenarioPopup();
                }
                if(selectedOp === 'delete'){
                    //deleting selected scenario.
                    deleteScenario();
                }
                if(selectedOp === 'user:pref'){
                    //preferences
                    console.log("Preferences");
                }
                if(selectedOp === 'user:region'){
                    //preferences
                    console.log("My region is: <%=user_info.region_name%>");
                }
                if(selectedOp === 'user:sout'){
                    window.location.href = '<%=home_url%>/logout';
                }
            }
        });

        
        let sidebar = new w2sidebar({
            box: '#sidebar',
            name: 'sidebar',
            style:'height:100%;',
            nodes: [
                <%for(let i = 0; i< scenarios.length;i++) {%>
                { id: '<%=scenarios[i].scenario_id%>', text: '<%=scenarios[i].description%>',  expanded: false,
                    nodes: [
                        { id: '<%=scenarios[i].scenario_id%>/dashboard', text: 'Dashboard', icon: 'fas fa-tachometer-alt' },
                        { id: '<%=scenarios[i].scenario_id%>/nodes', text: '<%= __('nodes_menu') %>', icon: 'fa-solid fa-bridge-water' },
                        { id: '<%=scenarios[i].scenario_id%>/consumers', text: '<%= __('consumers_menu') %>', icon: 'fa-solid fa-hand-holding-droplet' },   
                        { id: '<%=scenarios[i].scenario_id%>/flows', text: '<%= __('flows_menu') %>', icon: 'fa-solid fa-faucet' }
                    ]
                },
                <%}%>
            ],
            onClick:function(evt){
                let id = evt.target;
                let split_res = id.split("/");
                if(split_res.length === 1)
                    return;
                if(split_res[1] === 'dashboard'){
                    alert("Resumen Escenario")
                }
                else{
                    if(split_res[1] === 'nodes'){
                        //alert(split_res[0])
                        window.open('<%=home_url%>/'+ split_res[0] + '/nodes','nodes_'+ split_res[0],'toolbar=no,location=no,status=no,menubar=no,resizable=yes,width='+screen.availWidth+',height='+screen.availHeight);
                    }
                    
                    if(split_res[1] === 'consumers'){
                        window.open('<%=home_url%>/'+ split_res[0] + '/consumers','consumers_'+ split_res[0],'toolbar=no,location=no,status=no,menubar=no,resizable=yes,width='+screen.availWidth+',height='+screen.availHeight);
                    }
                    
                    if(split_res[1] === 'flows'){
                        window.open('<%=home_url%>/'+ split_res[0] + '/flows','flows_'+ split_res[0],'toolbar=no,location=no,status=no,menubar=no,resizable=yes,width='+screen.availWidth+',height='+screen.availHeight);
                    }else{
                        return;
                    }
                }
                console.log(id)
            }
        });
    </script>
</head>
<body>
    <div class="container-fluid">
        <div class="row" style="height:7%;">
            <div id="toolbar">
            </div>
        </div>
        <div class="row" id="contenido">
            <div class="col-sm-2 col-md-2" id="sidebar" style="position:relative; padding: 2px; margin-left: -20px;height:100%">
            </div>
            <div class="col-sm-10 col-md-10" id="main-content" style="height: 100%;position:relative;left:10px;">
                <main>
                    <div class="container-fluid px-4">
                        <h4 class="mt-4"><%=user_info.region_name%> - <%= __('welcome_message') %></h4>
                        <div class="row">
                            <div class="col-xl-3 col-md-6">
                                <div class="card text-white bg-danger mb-4">
                                    <div class="card-body">Critical Time: 145 days</div>
                                    <div class="card-footer d-flex align-items-center justify-content-between">
                                        <a class="small text-white stretched-link" href="#">View Details</a>
                                        <div class="small text-white"><i class="fas fa-angle-right"></i></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-3 col-md-6">
                                <div class="card text-white bg-danger mb-4">
                                    <div class="card-body">State: Empting</div>
                                    <div class="card-footer d-flex align-items-center justify-content-between">
                                        <a class="small text-white stretched-link" href="#">View Details</a>
                                        <div class="small text-white"><i class="fas fa-angle-right"></i></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-3 col-md-6">
                                <div class="card text-black mb-4">
                                    <div class="card-body">Inputs (in MM3): 25</div>
                                    <div class="card-footer d-flex align-items-center justify-content-between">
                                        <a class="small text-black stretched-link" href="#">View Details</a>
                                        <div class="small text-black"><i class="fas fa-angle-right"></i></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-3 col-md-6">
                                <div class="card text-black mb-4">
                                    <div class="card-body">Outputs (in MM3): 35</div>
                                    <div class="card-footer d-flex align-items-center justify-content-between">
                                        <a class="small text-black stretched-link" href="#">View Details</a>
                                        <div class="small text-black"><i class="fas fa-angle-right"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            More info about the current selected condition
                        </div>
                    </div>
                </main>
            </div>
        </div>
    </div>
</body>
</html>